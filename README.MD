# ğŸ§  OpenMP PR Scraper & Comment Analyzer

A GitHub data mining pipeline to collect, process, and analyze Pull Requests (PRs) from the LLVM/OpenMP project. It maps review and issue comments to code hunks and provides statistical summaries.


## ğŸ“¦ Dependencies

Install the required Python packages:

```bash
pip install -r requirements.txt
```

**`requirements.txt` should contain:**

```txt
requests
python-dotenv
matplotlib
pandas
```

## ğŸ” Environment Setup

Create a `.env` file in the project root with your GitHub token:

```env
GITHUB_TOKEN=ghp_your_personal_access_token_here
```

> Make sure your token has at least `read:public_repo` or `repo` scope.

---

## ğŸ—‚ï¸ File Structure

```bash
.
â”œâ”€â”€ .env
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ run_preprocessing.sh
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ openmp_prs.json                  # PRs and raw comments
â”‚   â”œâ”€â”€ openmp_hunks_comments.json       # Mapped comments to hunks
â”‚   â”œâ”€â”€ prs_with_review_comments.json    # Filtered PRs with inline comments
â”‚   â””â”€â”€ mapping_stats.json               # Final stats
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ collect_data.py
â”‚   â”œâ”€â”€ find_comments.py
â”‚   â”œâ”€â”€ preprocess_data.py
â”‚   â””â”€â”€ analyze_mappings.py
```

## â–¶ï¸ Project Workflow

### 1. ğŸ” Find PRs with Review Comments

```bash
python src/find_comments.py
```

**Output:** `data/prs_with_review_comments.json`


### 2. ğŸ§² Collect PR Data (Diffs + Comments)

```bash
python src/collect_data.py
```

**Output:** `data/openmp_prs.json`


### 3. ğŸ§® Map Comments to Code Hunks

```bash
python src/preprocess_data.py
```

**Output:** `data/openmp_hunks_comments.json`


### 4. ğŸ“Š Analyze Mappings & Generate Stats

```bash
python src/analyze_mappings.py
```

**Output:**

* Summary in terminal
* `data/mapping_stats.json`


### âœ… Run All Steps in One

```bash
chmod +x run_preprocessing.sh
./run_preprocessing.sh
```



## ğŸ“ Output Description

| File                            | Description                             |
| ------------------------------- | --------------------------------------- |
| `openmp_prs.json`               | Raw PRs with review + issue comments    |
| `openmp_hunks_comments.json`    | Comments mapped to file hunks           |
| `mapping_stats.json`            | Summary of comment stats                |
| `prs_with_review_comments.json` | PRs filtered to contain inline comments |



## ğŸ§ª Notes

* Review comments are inline comments attached to code.
* Issue comments are general PR discussions.
* Comment types are separated and analyzed independently.



---

## ğŸ§  Vector Database for Review Comment Retrieval

This module embeds PR diff-comment pairs using SentenceTransformers and stores them in a FAISS vector database. It enables fast similarity search to suggest historical review comments for new OpenMP code changes.

### ğŸ“¦ Dependencies

Install required Python packages (if not already installed):

```bash
pip install faiss-cpu sentence-transformers numpy
In case of errors with TensorFlow or protobuf, run:

bash
Copy
Edit
pip uninstall tensorflow
pip install protobuf==3.20.*
ğŸ—‚ï¸ File Overview
File	Purpose
src/build_vector_db.py	Builds the FAISS index using comment-context embeddings
src/query_vector_db.py	Queries the vector DB to retrieve similar past review comments
data/openmp_hunks_comments.json	Input JSON with PR metadata and review comments
data/faiss_index.idx	Output: FAISS vector index file
data/comments_lookup.json	Output: Stores original queries and associated comments

âš™ï¸ How to Use
ğŸ”¨ Build the Vector Database
bash
Copy
Edit
python src/build_vector_db.py
This will generate:

data/faiss_index.idx

data/comments_lookup.json

